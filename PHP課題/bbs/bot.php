<?php 
require_once 'dbconnect.php';

/**
 * このスクリプトは、掲示板に自動で投稿するBotの機能を実現します。
 * 1. Bot用のアカウントが存在するかチェックし、なければ作成します。
 * 2. 定義されたメッセージの中からランダムに1つを選び、Botとして投稿します。
 * 
 * 注意: このスクリプトを実行するたびに、1件の投稿が追加されます。
 *       定期的に自動投稿させたい場合は、cronジョブやタスクスケジューラで
 *       このスクリリプトを定期的に実行するように設定してください。
 */

header('Content-Type: text/html; charset=UTF-8');

// --- Botアカウント情報 ---
$bot_name = 'Bot';
$bot_email = 'bot@example.com';
$bot_password = 'bot_password_123'; // 本番環境ではより複雑なパスワードを使用してください

try {
    // 1. Botアカウントの存在チェックと作成
    $stmt = $db->prepare('SELECT id FROM members WHERE email = ?');
    $stmt->execute([$bot_email]);
    $bot_member = $stmt->fetch(PDO::FETCH_ASSOC);

    if (!$bot_member) {
        // アカウントが存在しない場合、作成する
        // login.phpのロジックに合わせてsha1でハッシュ化する
        $hashed_password = sha1($bot_password);
        $insert_stmt = $db->prepare('INSERT INTO members SET name=?, email=?, password=?, picture="" created=NOW()');
        $insert_stmt->execute([$bot_name, $bot_email, $hashed_password]);
        $bot_id = $db->lastInsertId();
        echo "Botアカウント「{$bot_name}」を作成しました。<br>";
    } else {
        // アカウントが既に存在する場合、IDを取得
        $bot_id = $bot_member['id'];
    }

    // 2. Botに投稿させるメッセージを定義
// ブラック企業の上司が部下に言いそうな言葉100選＋ゾス系メッセージ20選を配列に格納
$bot_messages = [
    // —————— 原則的に部下を責め立てる言葉 100選 ——————
    'そんなこともできないのか？', 
    '給料泥棒め！',
    '休むなら今すぐ辞めろ',
    'お前の価値はゼロだ',
    '定時なんて言葉はうちにはない',
    '残業代？そんなもの出せるわけないだろ',
    'ノルマ達成できないなら給料カットだ',
    'ミスしたのはお前だけじゃない、他もみんな我慢してる',
    '言い訳する暇があるなら働け',
    '逃げ道はないぞ',
    'お前の都合なんて聞いてない',
    '夜中でも電話は出ろ',
    '有給？そんな贅沢許さん',
    'もっと成果を出せ',
    'この程度で満足してるのか？',
    '文句があるなら辞めてもらって構わない',
    '指示待ちかよ、いい加減自分で考えろ',
    'お客様第一、社員は二の次',
    '他社に転職しようにも誰も雇わないぞ',
    '締切は明日だ、言い訳無用',
    'もっと働けるだろ？甘えるな',
    'お前ができないせいでみんなが迷惑してる',
    '責任を取る覚悟はあるのか？',
    '結果を出せないなら意味がない',
    '休憩時間は自己管理しろ',
    '泣き言は聞きたくない',
    '昨日と同じミスをするな',
    '上司の言うことに従え',
    '提案なんておこがましい',
    'プライベートは仕事のためにある',
    '寝る時間を惜しめ',
    '無能なやつほど話が長い',
    '過去は関係ない、結果だけだ',
    'できない理由じゃなく、できる方法を考えろ',
    '言った通りにやれ、それしかない',
    '自分で考えて行動できないなら要らない',
    'お客様に迷惑をかけるな',
    '期限延長なんて聞いたことない',
    'ミスの責任は全てお前にある',
    '新人だろうが関係ない',
    '効率？まず量をこなせ',
    '努力は評価しない、結果だけ見る',
    '体調が悪い？んなもの自己管理しろ',
    '目標未達は即クビ',
    '朝一番に来い、遅刻厳禁',
    'メールは即レスが基本',
    '何時間でも待ってるぞ',
    'お前の提案なんて期待してない',
    '嫌なら辞めろ、次はすぐ見つかる',
    '泣き言はSNSで書いてろ',
    'チームワーク？お前だけ出遅れてる',
    '責任転嫁は一番嫌いだ',
    '常に上司の顔色を伺え',
    'お前のミスで客を逃したらどうする？',
    '休みは会社の都合で決める',
    '面接のときはキラキラしてたのにな',
    '無理と言える奴は使い物にならない',
    'うちに甘えてると痛い目見るぞ',
    'お前の人生なんて知らん',
    '報告・連絡・相談？そんな暇あるか',
    '仕事は24時間365日',
    '「できません」は禁句だ',
    'お前の性格が仕事に合ってない',
    '社員は駒だ',
    '言われたこと以上は期待してない',
    '勝手な判断するな',
    '今日の失敗は明日の教訓じゃない、単なる失敗だ',
    'もっと貪欲に数字を追え',
    '人手が足りない？お前が増やせ',
    '忙しいのは皆同じだ',
    '叱られるうちが花だと思え',
    '早く終わらせて文句言われろ',
    'アイデア？まず納期だろ',
    '自己犠牲が足りない',
    'お前が休んだ分は他が死ぬほど働く',
    'ミスした日は自腹で支払え',
    '全員がモンスター',
    '結果を出さない奴に未来はない',
    '仕事がキツイ？甘やかされすぎだ',
    '退職届を書いてみたらどうだ？',
    '何も言わずに動け',
    '自分のキャリアを会社に捧げろ',
    '目標にコミットできないなら論外',
    '過去の栄光なんてゴミだ',
    'お前のミスはトップに直行する',
    '残業は美徳だと思え',
    '定時退社なんて存在しない',
    '努力が足りないと死ぬぞ',
    '言葉より行動で示せ',
    'どんな手を使っても構わない',
    '人間関係？仕事優先だ',
    'プライド捨てろ',
    '文句は給与明細に書け',
    '無駄話は業務時間外でしろ',
    'お前の弱みは全部把握してる',
    '生き残る気あるのか？',
    '上司の機嫌を取れ',
    'お前のミスはチームの恥だ',
    '人権なんて甘い言葉だ',
    '今日も遅くまで頑張ってもらうぞ',
    '今日も残業だ、覚悟しろ',
    'お前の仕事は俺の指示通りにやることだ'
];

    $message_to_post = $bot_messages[array_rand($bot_messages)];

    // 3. 投稿をデータベースに挿入
    $post_stmt = $db->prepare('INSERT INTO posts SET member_id=?, message=?, created=NOW()');
    $post_stmt->execute([$bot_id, $message_to_post]);

    echo "Botがメッセージを投稿しました: ''" . htmlspecialchars($message_to_post, ENT_QUOTES) . "」<br>";
    echo '<p><a href="index.php">掲示板に戻る</a></p>';

} catch (PDOException $e) {
    die('データベースエラー: ' . $e->getMessage());
}
?>
<script>
    setInterval(() => {
        location.reload();
    }, 10000);
</script>